function addUpdateHike(e){function t(){return $("#ul_addpeaks li").get().map(function(e){return ADK_PEAK={ADK_PEAK_ID:$(e.children[0]).data("peakid"),ADK_PEAK_DTE:e.children[1].innerHTML},ADK_PEAK})}addPeak();var a=t();if(0==a.length)return!1;document.getElementById("hidden_peaks").value=a.map(function(e){return e.ADK_PEAK_ID+" "+e.ADK_PEAK_DTE}).join(",");var n=$(".viewing a.hoverbtn").data("id"),d="Add Hike"===document.getElementById("h4span_addUpdateHike").innerHTML?"includes/hikeSave.php":"includes/hikeUpdate.php";$.ajax({url:d,data:new FormData(e),processData:!1,contentType:!1,enctype:"multipart/form-data",type:"POST",timeout:12e4,success:function(e){$("#div_modal_loading").modal("hide"),document.getElementById("div_table_hikes").innerHTML=e;var t=document.getElementById("table_hikes");document.getElementById("span_numclimbed").innerHTML=t.getAttribute("data-numclimbed"),document.getElementById("span_numpeaks").innerHTML=t.getAttribute("data-numpeaks")+" ("+t.getAttribute("data-percent")+"%)",cancelHike();document.getElementById("a_maxmin_hike_data");$('a.hoverbtn[data-id="'+n+'"]').click(),$(".dt").DataTable({pageLength:20,lengthChange:!1,order:[2,"desc"],columnDefs:[{targets:0,searchable:!1,sortable:!1}]}),markCompletedPeaks()},error:function(e){var t="";-1!==e.responseText.indexOf("t")&&(t+="Invalid file type\r\n"),-1!==e.responseText.indexOf("p")&&(t+=-1!==e.responseText.indexOf("1")||-1!==e.responseText.indexOf("2")?"Max file size exceeded\r\n":"Error uploading file\r\n"),alert(t),console.log(t),$("#div_modal_loading").modal("hide")}}),$("#div_modal_loading").modal("show")}function editHike(){cancelHike();var e=document.getElementById("span_maxminAddUpdateHike");e.classList.contains("glyphicon-chevron-up")&&$(e.parentNode).click();var t=document.getElementsByClassName("viewing")[0],a=getHikeInfo(t),n=(document.getElementById("ul_addpeaks"),document.getElementById("ul_hikeattachments"));document.getElementById("h4span_addUpdateHike").innerHTML="Update Hike",document.getElementById("button_addUpdateHike").innerHTML="Update Hike",document.getElementById("hidden_hikeid").value=a.ADK_HIKE_ID;for(var d=0;d<a.ADK_PEAKS.length;d++)addPeakLi(a.ADK_PEAKS[d]);for(var i=[],d=0;d<a.ADK_FILES.length;d++){var l=document.createElement("li");l.innerHTML='<a class="pointer hoverbtn redhover" onclick="removeFile(this, \''+a.ADK_FILES[d].ADK_FILE_ID+'\');" title="Size: '+$.fn.downloader.bytesToSize(a.ADK_FILES[d].ADK_FILE_SIZE)+"  Desc: "+a.ADK_FILES[d].ADK_FILE_DESC+'">'+a.ADK_FILES[d].ADK_FILE_NAME+"</a>",l.className="redhover",n.appendChild(l),i.push(a.ADK_FILES[d].ADK_FILE_ID)}document.getElementById("hidden_prefileids").value=i.join(","),document.getElementById("textbox_hikedate").value=a.ADK_HIKE_DTE;var o=getWysiIframeBody();o?o.innerHTML=a.ADK_HIKE_NOTES:document.getElementById("textbox_notes").value=a.ADK_HIKE_NOTES,$("html, body").animate({scrollTo:$(e).offset().top},600),enableDisable_addHike()}function deleteHike(){cancelHike();var e=document.getElementsByClassName("viewing")[0];$.post("includes/hikeDelete.php",{userid:document.getElementById("hikerId").value,hikeid:getHikeInfo(e).ADK_HIKE_ID},function(e){var t=document.getElementById("div_hike_data").parentNode;t.className=t.className.replace("max","min"),document.getElementById("div_table_hikes").innerHTML=e,document.getElementById("span_numpeaks").innerHTML=document.getElementById("table_hikes").getAttribute("data-numpeaks"),$(".dt").DataTable({pageLength:20,lengthChange:!1,order:[2,"desc"],columnDefs:[{targets:0,searchable:!1,sortable:!1}]}),markCompletedPeaks()}).error(function(e){var t="";-1!==e.responseText.indexOf("t")&&(t+="Invalid file type\r\n"),-1!==e.responseText.indexOf("p")&&(t+=-1!==e.responseText.indexOf("1")||-1!==e.responseText.indexOf("2")?"Max file size exceeded\r\n":"Error uploading file\r\n"),alert(t),console.log(t),$("#div_modal_loading").modal("hide")})}function cancelHike(){var e=document.getElementById("select_addpeaks");document.getElementById("h4span_addUpdateHike").innerHTML="Add Hike",document.getElementById("button_addUpdateHike").innerHTML="Add Hike",e.value="",document.getElementById("textbox_hikedate").value="",document.getElementById("textbox_notes").value="",document.getElementById("hidden_prefileids").value="";var t=getWysiIframeBody();t&&(t.innerHTML="");for(var a=document.getElementById("ul_addpeaks");a.firstChild;)a.removeChild(a.firstChild);for(document.getElementById("ul_hikeattachments").innerHTML="";ul_hikeattachments.firstChild;)ul_hikeattachments.removeChild(ul_hikeattachments.firstChild);$.fn.downloader.removeAll(),$(".wysihtml5-command-active").each(function(){$(this).click()}),markCompletedPeaks()}function getHikeInfo(e){var t=e.children[0].value,a=e.children[2].innerHTML,n="--"!==e.children[3].value?e.children[3].value:"",d=[].slice.call(e.children[4].children).map(function(e){return{ADK_PEAK_ID:$(e).data("id"),ADK_PEAK_NAME:$(e).data("name"),ADK_PEAK_HEIGHT:$(e).data("height"),ADK_PEAK_DTE:$(e).data("date")}}),i=[].slice.call(e.children[5].children).map(function(e){return{ADK_FILE_ID:$(e).data("id"),ADK_FILE_NAME:$(e).data("name"),ADK_FILE_DESC:$(e).data("desc"),ADK_FILE_SIZE:$(e).data("size"),ADK_FILE_TYPE:$(e).data("type")}});return{ADK_HIKE_ID:t,ADK_HIKE_NOTES:a,ADK_HIKE_DTE:n,ADK_PEAKS:d,ADK_FILES:i}}function viewHike(e){function t(e){return e.ADK_FILE_NAME+"\n"+(e.ADK_FILE_DESC?e.ADK_FILE_DESC+"\n":"")+$.fn.downloader.bytesToSize(e.ADK_FILE_SIZE)}$(".viewing").each(function(){this.classList.remove("viewing")}),e.classList.add("viewing");var a=getHikeInfo(e),n=document.getElementById("table_hikespeaks"),d=document.getElementById("p_hikenotes");n.children[1].innerHTML="",d.innerHTML=a.ADK_HIKE_NOTES,document.getElementById("a_heightFormat").innerHTML="(ft)";for(var i=0;i<a.ADK_PEAKS.length;i++){var l=document.createElement("tr"),o=document.createElement("td");o.innerHTML=a.ADK_PEAKS[i].ADK_PEAK_NAME;var r=document.createElement("td");r.innerHTML=a.ADK_PEAKS[i].ADK_PEAK_DTE;var s=document.createElement("td");s.innerHTML=a.ADK_PEAKS[i].ADK_PEAK_HEIGHT,l.appendChild(o),l.appendChild(r),l.appendChild(s),n.children[1].appendChild(l)}var c=!1,m=!1,_=$("ul.gallery-photo"),u=$("ul.gallery-video"),p=$("ul.gallery-files");_.empty(),u.empty(),p.empty();for(var i=0;i<a.ADK_FILES.length;i++)switch(a.ADK_FILES[i].ADK_FILE_TYPE){case"photo":$li=$('<li class="gallery col-xs-6 col-sm-4 col-md-3 col-lg-2">'),$a=$('<a href="#" class="photo" data-toggle="modal" data-target="#modal_gallery" data-id="'+a.ADK_FILES[i].ADK_FILE_ID+'" data-desc="'+a.ADK_FILES[i].ADK_FILE_DESC+'">'),$img=$('<img src="img/loading.gif" data-original="includes/fileGetImage.php?_='+a.ADK_FILES[i].ADK_FILE_ID+'&t=t" class="img-responsive imghover lazy" alt="'+a.ADK_FILES[i].ADK_FILE_NAME+'" title="'+t(a.ADK_FILES[i])+'" data-toggle="tooltip" data-container="body" data-placement="bottom" />'),$li.append($a.append($img)),_.append($li);break;case"video":var c=!0;$li=$('<li class="gallery" data-peaks="'+a.ADK_PEAKS.join(", ")+'">'),$a=$('<a href="#" class="video" data-toggle="modal" data-target="#modal_gallery" data-id="'+a.ADK_FILES[i].ADK_FILE_ID+'" data-desc="'+a.ADK_FILES[i].ADK_FILE_DESC+'">'),$span=$('<span title="'+t(a.ADK_FILES[i])+'" data-toggle="tooltip" data-container="body" data-placement="right">'+a.ADK_FILES[i].ADK_FILE_NAME+"</span>"),u.append($li.append($a.append($span)));break;case"doc":m=!0,$li=$('<li class="gallery" data-peaks="'+a.ADK_PEAKS.join(", ")+'">'),$a=$('<a href="#" data-id="'+a.ADK_FILES[i].ADK_FILE_ID+'">'),$span=$('<span title="'+t(a.ADK_FILES[i])+'" data-toggle="tooltip" data-container="body" data-placement="right">'+a.ADK_FILES[i].ADK_FILE_NAME+"</span>"),p.append($li.append($a.append($span))),$a.on("click",function(){getFile($(this).data("id"))})}$("img.lazy").lazyload({container:$("#div_photos"),effect:"fadeIn",threshold:10}),bindPhotoModal(),c?$(".gallery-video-header").show():$(".gallery-video-header").hide(),m?$(".gallery-doc-header").show():$(".gallery-doc-header").hide(),$(e).parents("div.container-fluid")[0].nextElementSibling.classList.contains("content-min")&&$("#a_maxmin_hike_data").click(),tooltip(),$(".selecttable").trigger("update"),$("html, body").animate({scrollTop:$("#div_hike_data").offset().top},600)}function convertFormat(e){var t=document.getElementById("table_hikespeaks").children[1];if(-1===e.innerHTML.indexOf("m")){for(var a=0;a<t.children.length;a++){var n=t.children[a].children[2];n.innerHTML=Math.round(parseFloat(n.innerHTML)/3.2808)}e.innerHTML="(m)"}else{for(var a=0;a<t.children.length;a++){var n=t.children[a].children[2];n.innerHTML=Math.round(3.2808*parseFloat(n.innerHTML))}e.innerHTML="(ft)"}}function enableDisable_addHike(){function e(e){e?(t.disabled=!0,t.classList.add("disabled")):(t.disabled=!1,t.classList.remove("disabled"))}var t=document.getElementById("button_addUpdateHike");if(e(!1),""!==document.getElementById("span_fileerror").innerHTML)return document.getElementsByClassName("jqdl-attachments")[0].classList.add("has-error"),void e(!0);if($(this).find(".has-error").length>0)return void e(!0);var a=document.getElementById("ul_addpeaks");return""===document.getElementById("select_addpeaks").value&&""===a.innerHTML?void e(!0):($(".addpeak-date").each(function(){return"???"===this.innerHTML?void e(!0):void 0}),""===a.innerHTML||""===document.getElementById("select_addpeaks").value&&""===document.getElementById("textbox_hikedate").value?void e(!1):void 0)}function modal_hike(){var e=getHikeInfo(document.querySelector("td.viewing"));document.getElementById("h4_modal_hike_label").innerHTML=e.ADK_PEAKS.map(function(e){return e.ADK_PEAK_NAME}).join(", "),document.getElementById("span_modal_hike_date").innerHTML=e.ADK_HIKE_DTE,document.getElementById("modal_dike_notes").innerHTML=e.ADK_HIKE_NOTES}function printView(){var e={ADK_USER_NAME:document.getElementById("hidden_ADK_HIKER_NAME").value,ADK_USER_USERNAME:document.getElementById("hidden_ADK_HIKER_USERNAME").value},t=getHikeInfo(document.querySelector("td.viewing")),a=window.open(),n="<script>function a(d){var b=document.body.style.fontSize? parseInt(document.body.style.fontSize.replace(/D/g,'')):100;if(b>=50&&b<=150){if(d)b+=10;else b-=10;}if(b<50)b=50;if(b>150)b=150;document.body.style.fontSize=b+'%';}</script>",d='<h3 style="margin-bottom:8px;text-align:center;">The Adirondack Forty-Sixers';d+='<div class="noprint" style="font-size:16px;float:right;"><a href="#" style="text-decoration:none;" onclick="a(0)" title="Zoom out">-</a>&nbsp;|&nbsp;<a href="#" style="text-decoration:none;" onclick="a(1)" title="Zoom in">+</a><br /></div>',d+="</h3>",d+='<img src="img/letterhead.png" style="height:70px;float:right;margin-right:10%;" onload="window.print()" />',d+="",d+="<span>"+e.ADK_USER_NAME+" ("+e.ADK_USER_USERNAME+")</span><br /><br />",d+="<span>Date: "+t.ADK_HIKE_DTE+"</span><br />",d+="<span>"+t.ADK_PEAKS.map(function(e){return e.ADK_PEAK_NAME}).join(", ")+"</span><br />",d+="----------------------------------------<br /><br />",d+='<pre style="word-break:break-word;">'+t.ADK_HIKE_NOTES+"</pre>",a.document.write(n+d)}function bindPhotoModal(){$("#div_photos .photo").on("click",function(){var e=getDownloadLink(this.getAttribute("data-id"))+"<strong>"+this.getAttribute("data-un")+"</strong><br />"+this.getAttribute("data-peaks")+'<div class="hr"></div>'+this.getAttribute("data-desc");document.getElementById("modal_gallery_label").innerHTML=this.children[0].getAttribute("alt"),document.getElementById("modal_gallery_desc").innerHTML=e;var t=this.children[0].cloneNode();return t.setAttribute("data-original",t.src.replace("&t=t","")),t.src="img/loading.gif",t.classList.remove("imghover"),$("#modal_gallery_container").html("").append(t),$(t).attr("src",$(t).data("original")),!0}),$("#div_videos .video").on("click",function(){var e=this.getAttribute("data-id"),t=this.children[0].innerHTML,a=getDownloadLink(this.getAttribute("data-id"))+"<strong>"+this.getAttribute("data-un")+"</strong><br />"+this.getAttribute("data-peaks")+'<div class="hr"></div>'+this.getAttribute("data-desc");document.getElementById("modal_gallery_label").innerHTML=t,document.getElementById("modal_gallery_desc").innerHTML=a;var n=document.createElement("video");return n.setAttribute("id","video"),n.setAttribute("controls","controls"),n.setAttribute("width","100%"),n.innerHTML='<source id="videosource" src="includes/fileGetVideo.php?_='+e+'" type="video/'+t.split(".").pop()+'" />',document.getElementById("modal_gallery_container").innerHTML=n.outerHTML,bindVideoError(),!0})}function addPeak(e){if(e||(e=document.getElementById("select_addpeaks")),""!==e.value){var t=e.options[e.selectedIndex];t.classList.add("font-italic");var a=document.getElementById("textbox_hikedate"),n={ADK_PEAK_ID:e.value,ADK_PEAK_NAME:t.innerHTML,ADK_PEAK_DTE:a.value};if(!/(0[1-9]|1[012])[- \/.](0[1-9]|[12][0-9]|3[01])[- \/.](19|20)\d\d/.test(n.ADK_PEAK_DTE))return $(a).blur(),!1;e.selectedIndex=-1,addPeakLi(n),tooltip()}}function addPeakLi(e){var t=document.getElementById("ul_addpeaks"),a=$("<li>"),n=$('<a class="addpeak-name" title="Remove Peak" data-toggle="tooltip" data-container="body" data-peakid="'+e.ADK_PEAK_ID+'">'+e.ADK_PEAK_NAME+"</a>"),d=$('<a class="addpeak-date">'+("--"===e.ADK_PEAK_DTE?"???":e.ADK_PEAK_DTE)+"</a>");a.append(n),a[0].innerHTML+="(",a.append(d),a[0].innerHTML+=")",t.appendChild(a[0])}function editPeakDate(e){var t=$('<input type="text" class="date" value="'+e.innerHTML+'" style="visibility:hidden;width:0;height:0;">');$(e.parentNode).append(t),t.datepicker({changeMonth:!0,changeYear:!0,maxDate:"+2d",yearRange:"-100:+0"}).datepicker("show").on("change",function(){$(this).datepicker("hide").datepicker("destroy"),e.innerHTML=this.value,enableDisable_addHike(),$(this).remove()}).on("blur",function(){enableDisable_addHike(),$(this).remove()})}function removePeak(e){$(e.parentNode).remove(),enableDisable_addHike(),tooltip(),markCompletedPeaks();var t=document.getElementById("select_addpeaks").children;$(".addpeak-name").each(function(){for(var e=0;e<t.length;e++)$(this).data("peakid")==t[e].value&&t[e].classList.add("font-italic")})}function markCompletedPeaks(){var e=document.getElementById("hidden_usedPeakIDs").value.split(",");$("#select_addpeaks option").each(function(){-1!==e.indexOf(this.value)?this.classList.add("font-italic"):this.classList.remove("font-italic")})}function removeFile(e,t){hidden_prefileids=document.getElementById("hidden_prefileids");for(var a=hidden_prefileids.value.split(","),n=[],d=0;d<a.length;d++)a[d]!==t&&n.push(a[d]);hidden_prefileids.value=n.join(","),e.parentNode.outerHTML=""}$(document).ready(function(){var e=document.getElementById("hidden_ADK_MESSAGE_JSON");if(e){var t=JSON.parse(e.value);document.getElementById("textbox_notes").value=t.content;for(var a=[],n=0;n<t.files.length;n++){a.push(t.files[n].id);var d='<li><a class="pointer hoverbtn" data-id="'+t.files[n].id+'" data-desc="'+t.files[n].desc+'" data-size="'+t.files[n].size+'"onclick="getFile('+t.files[n].id+');">'+t.files[n].name+"</a></li>";document.getElementById("ul_hikeattachments").innerHTML+=d}document.getElementById("hidden_prefileids").value=a.join(","),$("html, body").animate({scrollTop:$(span_maxminAddUpdateHike).offset().top},600)}if($("#form_addUpdateHike, #textbox_hikedate").on("change",enableDisable_addHike),parseInt(window.location.hash.replace("#",""))){var i=window.location.hash.replace("#","");$('input[name="hikeid"][value="'+i+'"]').parent().children().last().click()}$("#ul_addpeaks").on("click",".addpeak-name",function(){removePeak(this)}).on("mouseenter",".addpeak-name",function(){this.parentNode.classList.add("redhover-on")}).on("mouseleave",".addpeak-name",function(){this.parentNode.classList.remove("redhover-on")}),$("#ul_addpeaks").on("click",".addpeak-date",function(){editPeakDate(this)}),markCompletedPeaks()});
function addUpdateHike(e){function t(){return $("#ul_addpeaks li").get().map(function(e){return ADK_PEAK={ADK_PEAK_ID:$(e.children[0]).data("peakid"),ADK_PEAK_DTE:e.children[1].innerHTML},ADK_PEAK})}addPeak();var n=t();if(0==n.length)return!1;document.getElementById("hidden_peaks").value=n.map(function(e){return e.ADK_PEAK_ID+" "+e.ADK_PEAK_DTE}).join(",");var a="Add Hike"===document.getElementById("h4span_addUpdateHike").innerHTML?"includes/hikeSave.php":"includes/hikeUpdate.php";$.ajax({url:a,data:new FormData(e),processData:!1,contentType:!1,enctype:"multipart/form-data",type:"POST",timeout:12e4,success:function(e){$("#div_modal_loading").modal("hide"),document.getElementById("div_table_hikes").innerHTML=e,document.getElementById("span_totalpeaks").innerHTML=getUsedPeakIDs().length,cancelHike();var t=document.getElementById("a_maxmin_hike_data");-1!==t.children[0].className.indexOf("down")&&$(t).click(),$(".dt").DataTable({pageLength:20,lengthChange:!1,order:[2,"desc"],columnDefs:[{targets:0,searchable:!1,sortable:!1}]})},error:function(e){var t="";-1!==e.responseText.indexOf("t")&&(t+="Invalid file type\r\n"),-1!==e.responseText.indexOf("p")&&(t+=-1!==e.responseText.indexOf("1")||-1!==e.responseText.indexOf("2")?"Max file size exceeded\r\n":"Error uploading file\r\n"),alert(t),console.log(t),$("#div_modal_loading").modal("hide")}}),$("#div_modal_loading").modal("show")}function editHike(){cancelHike();var e=document.getElementById("span_maxminAddUpdateHike");e.classList.contains("glyphicon-chevron-up")&&$(e.parentNode).click();var t=document.getElementsByClassName("viewing")[0],n=getHikeInfo(t),a=(document.getElementById("ul_addpeaks"),document.getElementById("ul_hikeattachments"));document.getElementById("h4span_addUpdateHike").innerHTML="Update Hike",document.getElementById("button_addUpdateHike").innerHTML="Update Hike",document.getElementById("hidden_hikeid").value=n.ADK_HIKE_ID;for(var d=0;d<n.ADK_PEAKS.length;d++)addPeakLi(n.ADK_PEAKS[d]);for(var i=[],d=0;d<n.ADK_FILES.length;d++){var l=document.createElement("li");l.innerHTML='<a class="pointer hoverbtn redhover" onclick="removeFile(this, \''+n.ADK_FILES[d].ADK_FILE_ID+'\');" title="Size: '+$.fn.downloader.bytesToSize(n.ADK_FILES[d].ADK_FILE_SIZE)+"  Desc: "+n.ADK_FILES[d].ADK_FILE_DESC+'">'+n.ADK_FILES[d].ADK_FILE_NAME+"</a>",l.className="redhover",a.appendChild(l),i.push(n.ADK_FILES[d].ADK_FILE_ID)}document.getElementById("hidden_prefileids").value=i.join(","),document.getElementById("textbox_hikedate").value=n.ADK_HIKE_DTE;var o=getWysiIframeBody();o?o.innerHTML=n.ADK_HIKE_NOTES:document.getElementById("textbox_notes").value=n.ADK_HIKE_NOTES,enableDisable_addHike(),$("html, body").animate({scrollTo:$(e).offset().top},600)}function deleteHike(){cancelHike();var e=document.getElementsByClassName("viewing")[0];$.post("includes/hikeDelete.php",{userid:document.getElementById("hikerId").value,hikeid:getHikeInfo(e).ADK_HIKE_ID},function(e){var t=document.getElementById("div_hike_data").parentNode;t.className=t.className.replace("max","min"),document.getElementById("div_table_hikes").innerHTML=e,document.getElementById("span_totalpeaks").innerHTML=document.getElementById("table_hikes").getAttribute("data-numpeaks"),$(".dt").DataTable({pageLength:20,lengthChange:!1,order:[2,"desc"],columnDefs:[{targets:0,searchable:!1,sortable:!1}]})}).error(function(e){var t="";-1!==e.responseText.indexOf("t")&&(t+="Invalid file type\r\n"),-1!==e.responseText.indexOf("p")&&(t+=-1!==e.responseText.indexOf("1")||-1!==e.responseText.indexOf("2")?"Max file size exceeded\r\n":"Error uploading file\r\n"),alert(t),console.log(t),$("#div_modal_loading").modal("hide")})}function cancelHike(){var e=document.getElementById("select_remainingpeaks");document.getElementById("h4span_addUpdateHike").innerHTML="Add Hike",document.getElementById("button_addUpdateHike").innerHTML="Add Hike",e.value="",document.getElementById("textbox_hikedate").value="",document.getElementById("textbox_notes").value="",document.getElementById("hidden_prefileids").value="";var t=getWysiIframeBody();t&&(t.innerHTML="");for(var n=document.getElementById("ul_addpeaks");n.firstChild;)n.removeChild(n.firstChild);for(document.getElementById("ul_hikeattachments").innerHTML="";ul_hikeattachments.firstChild;)ul_hikeattachments.removeChild(ul_hikeattachments.firstChild);$.fn.downloader.removeAll(),$(".wysihtml5-command-active").each(function(){$(this).click()})}function getHikeInfo(e){var t=e.children[0].value,n=e.children[2].innerHTML,a="N/A"!==e.children[3].value?e.children[3].value:"",d=[].slice.call(e.children[4].children).map(function(e){return{ADK_PEAK_ID:$(e).data("id"),ADK_PEAK_NAME:$(e).data("name"),ADK_PEAK_HEIGHT:$(e).data("height"),ADK_PEAK_DTE:$(e).data("date")}}),i=[].slice.call(e.children[5].children).map(function(e){return{ADK_FILE_ID:$(e).data("id"),ADK_FILE_NAME:$(e).data("name"),ADK_FILE_DESC:$(e).data("desc"),ADK_FILE_SIZE:$(e).data("size")}});return{ADK_HIKE_ID:t,ADK_HIKE_NOTES:n,ADK_HIKE_DTE:a,ADK_PEAKS:d,ADK_FILES:i}}function viewHike(e){function t(e){var t=e.split(".").pop();switch(t){case"jpg":case"jpeg":case"png":case"gif":case"tif":case"tiff":return"Picture";case"mpg":case"mpeg":case"avi":case"mov":case"webm":case"mkv":case"flv":case"ogg":case"oggv":case"wmv":case"mp4":return"Video";default:return"Doc/File"}}$(".viewing").each(function(){this.classList.remove("viewing")}),e.classList.add("viewing");var n=getHikeInfo(e),a=document.getElementById("table_hikespeaks"),d=document.getElementById("table_hikeattachments"),i=document.getElementById("span_hikenotes");a.children[1].innerHTML="",d.children[1].innerHTML="",i.innerHTML=n.ADK_HIKE_NOTES,document.getElementById("a_heightFormat").innerHTML="(ft)";for(var l=0;l<n.ADK_PEAKS.length;l++){var o=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n.ADK_PEAKS[l].ADK_PEAK_NAME;var c=document.createElement("td");c.innerHTML=n.ADK_PEAKS[l].ADK_PEAK_DTE;var s=document.createElement("td");s.innerHTML=n.ADK_PEAKS[l].ADK_PEAK_HEIGHT,o.appendChild(r),o.appendChild(c),o.appendChild(s),a.children[1].appendChild(o)}for(var l=0;l<n.ADK_FILES.length;l++){var o=document.createElement("tr"),r=document.createElement("td");r.innerHTML='<a class="pointer hoverbtn" onclick="getFile('+n.ADK_FILES[l].ADK_FILE_ID+');"><span class="glyphicon glyphicon-download" title="Download" data-toggle="tooltip" data-placement="top" data-container="body"></span></a>',r.style["padding-left"]="0";var c=document.createElement("td");c.innerHTML=n.ADK_FILES[l].ADK_FILE_NAME;var s=document.createElement("td");s.innerHTML=n.ADK_FILES[l].ADK_FILE_DESC;var m=document.createElement("td");m.innerHTML=t(n.ADK_FILES[l].ADK_FILE_NAME);var _=document.createElement("td");_.innerHTML=$.fn.downloader.bytesToSize(n.ADK_FILES[l].ADK_FILE_SIZE),o.appendChild(r),o.appendChild(c),o.appendChild(s),o.appendChild(m),o.appendChild(_),d.children[1].appendChild(o)}$(e).parents("div.container-fluid")[0].nextElementSibling.classList.contains("content-min")&&$("#a_maxmin_hike_data").click(),tooltip(),$("html, body").animate({scrollTop:$("#div_hike_data").offset().top},600)}function getUsedPeakIDs(){for(var e=document.getElementById("hidden_usedPeakIDs").value.split(","),t=0;t<e.length;t++)e[t]=parseInt(e[t]);return e}function convertFormat(e){var t=document.getElementById("table_hikespeaks").children[1];if(-1===e.innerHTML.indexOf("m")){for(var n=0;n<t.children.length;n++){var a=t.children[n].children[2];a.innerHTML=Math.round(parseFloat(a.innerHTML)/3.2808)}e.innerHTML="(m)"}else{for(var n=0;n<t.children.length;n++){var a=t.children[n].children[2];a.innerHTML=Math.round(3.2808*parseFloat(a.innerHTML))}e.innerHTML="(ft)"}}function enableDisable_addHike(){function e(e){e?(t.disabled=!0,t.classList.add("disabled")):(t.disabled=!1,t.classList.remove("disabled"))}var t=document.getElementById("button_addUpdateHike");return e(!1),""!==document.getElementById("span_fileerror").innerHTML?(document.getElementsByClassName("jqdl-attachments")[0].classList.add("has-error"),void e(!0)):$(this).find(".has-error").length>0?void e(!0):""===document.getElementById("select_remainingpeaks").value&&""===document.getElementById("ul_addpeaks").innerHTML&&""===document.getElementById("textbox_hikedate").innerHTML?void e(!0):void 0}function modal_hike(){var e=getHikeInfo(document.querySelector("td.viewing"));document.getElementById("h4_modal_hike_label").innerHTML=e.ADK_PEAKS.map(function(e){return e.ADK_PEAK_NAME}).join(", "),document.getElementById("span_modal_hike_date").innerHTML=e.ADK_HIKE_DTE,document.getElementById("modal_dike_notes").innerHTML=e.ADK_HIKE_NOTES}function printView(){var e={ADK_USER_NAME:document.getElementById("hidden_ADK_HIKER_NAME").value,ADK_USER_USERNAME:document.getElementById("hidden_ADK_HIKER_USERNAME").value},t=getHikeInfo(document.querySelector("td.viewing")),n=window.open(),a="<script>function a(d){var b=document.body.style.fontSize? parseInt(document.body.style.fontSize.replace(/D/g,'')):100;if(b>=50&&b<=150){if(d)b+=10;else b-=10;}if(b<50)b=50;if(b>150)b=150;document.body.style.fontSize=b+'%';}</script>",d='<h3 style="margin-bottom:8px;text-align:center;">The Adirondack Forty-Sixers';d+='<div class="noprint" style="font-size:16px;float:right;"><a href="#" style="text-decoration:none;" onclick="a(0)" title="Zoom out">-</a>&nbsp;|&nbsp;<a href="#" style="text-decoration:none;" onclick="a(1)" title="Zoom in">+</a><br /></div>',d+="</h3>",d+='<img src="img/letterhead.png" style="height:70px;float:right;margin-right:10%;" onload="window.print()" />',d+="",d+="<span>"+e.ADK_USER_NAME+" ("+e.ADK_USER_USERNAME+")</span><br /><br />",d+="<span>Date: "+t.ADK_HIKE_DTE+"</span><br />",d+="<span>"+t.ADK_PEAKS.map(function(e){return e.ADK_PEAK_NAME}).join(", ")+"</span><br />",d+="----------------------------------------<br /><br />",d+='<pre style="word-break:break-word;">'+t.ADK_HIKE_NOTES+"</pre>",n.document.write(a+d)}function addPeak(e){if(e||(e=document.getElementById("select_remainingpeaks")),""!==e.value){var t=e.options[e.selectedIndex],n=document.getElementById("textbox_hikedate"),a={ADK_PEAK_ID:e.value,ADK_PEAK_NAME:t.innerHTML,ADK_PEAK_DTE:n.value};if(!/(0[1-9]|1[012])[- \/.](0[1-9]|[12][0-9]|3[01])[- \/.](19|20)\d\d/.test(a.ADK_PEAK_DTE))return $(n).blur(),!1;e.selectedIndex=-1,addPeakLi(a),tooltip()}}function addPeakLi(e){var t=document.getElementById("ul_addpeaks"),n=$("<li>"),a=$('<a class="addpeak-name" title="Remove Peak" data-toggle="tooltip" data-container="body" data-peakid="'+e.ADK_PEAK_ID+'">'+e.ADK_PEAK_NAME+"</a>"),d=$('<a class="addpeak-date">'+e.ADK_PEAK_DTE+"</a>");n.append(a),n[0].innerHTML+="(",n.append(d),n[0].innerHTML+=")",t.appendChild(n[0])}function editPeakDate(e){var t=$('<input type="text" class="date" value="'+e.innerHTML+'" style="visibility:hidden;width:0;height:0;">');$(e.parentNode).append(t),t.datepicker({changeMonth:!0,changeYear:!0,maxDate:"+2d",yearRange:"-100:+0"}).datepicker("show").on("change",function(){$(this).datepicker("hide").datepicker("destroy"),e.innerHTML=this.value,$(this).remove()})}function removePeak(e){$(e.parentNode).remove(),enableDisable_addHike(),tooltip()}function removeFile(e,t){hidden_prefileids=document.getElementById("hidden_prefileids");for(var n=hidden_prefileids.value.split(","),a=[],d=0;d<n.length;d++)n[d]!==t&&a.push(n[d]);hidden_prefileids.value=a.join(","),e.parentNode.outerHTML=""}$(document).ready(function(){var e=document.getElementById("hidden_ADK_MESSAGE_JSON");if(e){var t=JSON.parse(e.value);document.getElementById("textbox_notes").value=t.content;for(var n=[],a=0;a<t.files.length;a++){n.push(t.files[a].id);var d='<li><a class="pointer hoverbtn" data-id="'+t.files[a].id+'" data-desc="'+t.files[a].desc+'" data-size="'+t.files[a].size+'"onclick="getFile('+t.files[a].id+');">'+t.files[a].name+"</a></li>";document.getElementById("ul_hikeattachments").innerHTML+=d}document.getElementById("hidden_prefileids").value=n.join(","),$("html, body").animate({scrollTop:$(span_maxminAddUpdateHike).offset().top},600)}if($("#form_addUpdateHike").on("change",enableDisable_addHike),parseInt(window.location.hash.replace("#",""))){var i=window.location.hash.replace("#","");$('input[name="hikeid"][value="'+i+'"]').parent().children().last().click()}$("#ul_addpeaks").on("click",".addpeak-name",function(){removePeak(this)}).on("mouseenter",".addpeak-name",function(){this.parentNode.classList.add("redhover-on")}).on("mouseleave",".addpeak-name",function(){this.parentNode.classList.remove("redhover-on")}),$("#ul_addpeaks").on("click",".addpeak-date",function(){editPeakDate(this)})});
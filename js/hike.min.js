function addUpdateHike(e){addPeak();var t=getPeakIds();if(0==t.length)return!1;document.getElementById("hidden_peakids").value=t.join(",");var n="Add Hike"===document.getElementById("h4span_addUpdateHike").innerHTML?"includes/ajax_addHike.php":"includes/ajax_updateHike.php";$.ajax({url:n,data:new FormData(e),processData:!1,contentType:!1,enctype:"multipart/form-data",type:"POST",timeout:12e4,success:function(e){$("#div_modal_loading").modal("hide"),document.getElementById("div_table_hikes").innerHTML=e,document.getElementById("span_totalpeaks").innerHTML=getUsedPeakIDs().length,cancelHike();var t=document.getElementById("a_maxmin_hike_data");-1!==t.children[0].className.indexOf("down")&&$(t).click()},fail:function(e){$("#div_modal_loading").modal("hide"),console.log(e)}}),$("#div_modal_loading").modal("show")}function editHike(){cancelHike();var e=document.getElementById("span_maxminAddUpdateHike");e.classList.contains("glyphicon-chevron-up")&&$(e.parentNode).click();var t=document.getElementsByClassName("viewing")[0],n=getHikeInfo(t),a=document.getElementById("div_peaks_container"),d=document.getElementById("ul_hikeattachments");document.getElementById("h4span_addUpdateHike").innerHTML="Update Hike",document.getElementById("button_addUpdateHike").innerHTML="Update Hike",document.getElementById("hidden_hikeid").value=n.ADK_HIKE_ID;for(var i=0;i<n.ADK_PEAKS.length;i++){var l=document.createElement("span");l.innerHTML=n.ADK_PEAKS[i].ADK_PEAK_NAME,l.className="redhover",l.setAttribute("onclick","removePeak(this);"),l.setAttribute("data-peakid",n.ADK_PEAKS[i].ADK_PEAK_ID),a.appendChild(l)}for(var o=[],i=0;i<n.ADK_FILES.length;i++){var r=document.createElement("li");r.innerHTML='<a class="pointer hoverbtn redhover" onclick="removeFile(this, \''+n.ADK_FILES[i].ADK_FILE_ID+'\');" title="Size: '+$.fn.downloader.bytesToSize(n.ADK_FILES[i].ADK_FILE_SIZE)+"  Desc: "+n.ADK_FILES[i].ADK_FILE_DESC+'">'+n.ADK_FILES[i].ADK_FILE_NAME+"</a>",r.className="redhover",d.appendChild(r),o.push(n.ADK_FILES[i].ADK_FILE_ID)}document.getElementById("hidden_prefileids").value=o.join(","),document.getElementById("textbox_hikedate").value=n.ADK_HIKE_DTE,document.getElementById("textbox_notes").value=n.ADK_HIKE_NOTES,$("html, body").animate({scrollTo:$(e).offset().top},600)}function deleteHike(){cancelHike();var e=document.getElementsByClassName("viewing")[0];$.post("includes/ajax_deleteHike.php",{userid:document.getElementById("hikerId").value,hikeid:getHikeInfo(e).ADK_HIKE_ID},function(e){document.getElementById("div_table_hikes").innerHTML=e,document.getElementById("span_totalpeaks").innerHTML=getUsedPeakIDs().length,document.getElementById("div_hike_data").parentNode.className.replace("max","min"),enableDisableSelectOptions(getUsedPeakIDs())})}function cancelHike(){var e=document.getElementById("h4span_addUpdateHike"),t=document.getElementById("select_remainingpeaks");"Add Hike"!==e.innerHTML&&(e.innerHTML="Add Hike",document.getElementById("button_addUpdateHike").innerHTML="Add Hike"),t.value="";var n=getUsedPeakIDs();enableDisableSelectOptions(n),document.getElementById("textbox_hikedate").value="",document.getElementById("textbox_notes").value="",document.getElementById("div_peaks_container").innerHTML="",document.getElementById("ul_hikeattachments").innerHTML="",$.fn.downloader.removeAll(),document.getElementById("hidden_hikeid").value}function getHikeInfo(e){for(var t=e.children[0].value,n=e.children[2].value,a="N/A"!==e.children[3].value?e.children[3].value:"",d=[],i=[],l=e.children[4].children,o=0;o<l.length;o++){var r={};r.ADK_PEAK_ID=$(l[o]).data("id"),r.ADK_PEAK_NAME=$(l[o]).data("name"),r.ADK_PEAK_HEIGHT=$(l[o]).data("height"),d.push(r)}for(var c=e.children[5].children,o=0;o<c.length;o++){var s={};s.ADK_FILE_ID=$(c[o]).data("id"),s.ADK_FILE_NAME=$(c[o]).data("name"),s.ADK_FILE_DESC=$(c[o]).data("desc"),s.ADK_FILE_SIZE=$(c[o]).data("size"),i.push(s)}return{ADK_HIKE_ID:t,ADK_HIKE_NOTES:n,ADK_HIKE_DTE:a,ADK_PEAKS:d,ADK_FILES:i}}function viewHike(e){function t(e){var t=e.split(".").pop();switch(t){case"jpg":case"jpeg":case"png":case"gif":case"tif":case"tiff":return"Picture";case"mpg":case"mpeg":case"avi":case"mov":case"webm":case"mkv":case"flv":case"ogg":case"oggv":case"wmv":case"mp4":return"Video";default:return"Doc/File"}}$(".viewing").each(function(){this.classList.remove("viewing")}),e.classList.add("viewing");var n=getHikeInfo(e),a=document.getElementById("table_hikespeaks"),d=document.getElementById("table_hikeattachments"),i=document.getElementById("span_hikenotes");a.children[1].innerHTML="",d.children[1].innerHTML="",i.innerHTML=n.ADK_HIKE_NOTES,document.getElementById("a_heightFormat").innerHTML="(ft)";for(var l=0;l<n.ADK_PEAKS.length;l++){var o=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n.ADK_PEAKS[l].ADK_PEAK_NAME;var c=document.createElement("td");c.innerHTML=n.ADK_PEAKS[l].ADK_PEAK_HEIGHT,o.appendChild(r),o.appendChild(c),a.children[1].appendChild(o)}for(var l=0;l<n.ADK_FILES.length;l++){var o=document.createElement("tr"),r=document.createElement("td");r.innerHTML='<a class="pointer hoverbtn" onclick="getFile('+n.ADK_FILES[l].ADK_FILE_ID+');"><span class="glyphicon glyphicon-download" title="Download" data-toggle="tooltip" data-placement="top" data-container="body"></span></a>',r.style["padding-left"]="0";var c=document.createElement("td");c.innerHTML=n.ADK_FILES[l].ADK_FILE_NAME;var s=document.createElement("td");s.innerHTML=n.ADK_FILES[l].ADK_FILE_DESC;var m=document.createElement("td");m.innerHTML=t(n.ADK_FILES[l].ADK_FILE_NAME);var _=document.createElement("td");_.innerHTML=$.fn.downloader.bytesToSize(n.ADK_FILES[l].ADK_FILE_SIZE),o.appendChild(r),o.appendChild(c),o.appendChild(s),o.appendChild(m),o.appendChild(_),d.children[1].appendChild(o)}$(e).parents("div.container-fluid")[0].nextElementSibling.classList.contains("content-min")&&$("#a_maxmin_hike_data").click(),tooltip(),$(".selecttable").trigger("update"),$("html, body").animate({scrollTop:$("#div_hike_data").offset().top},600)}function getPeakIds(){for(var e=document.getElementById("div_peaks_container").querySelectorAll("span"),t=[],n=0;n<e.length;n++)t.push($(e[n]).data("peakid"));return t}function getUsedPeakIDs(){for(var e=document.getElementById("hidden_usedPeakIDs").value.split(","),t=0;t<e.length;t++)e[t]=parseInt(e[t]);return e}function convertFormat(e){var t=document.getElementById("table_hikespeaks").children[1];if(-1===e.innerHTML.indexOf("m")){for(var n=0;n<t.children.length;n++){var a=t.children[n].children[1];a.innerHTML=Math.round(parseFloat(a.innerHTML)/3.2808)}e.innerHTML="(m)"}else{for(var n=0;n<t.children.length;n++){var a=t.children[n].children[1];a.innerHTML=Math.round(3.2808*parseFloat(a.innerHTML))}e.innerHTML="(ft)"}}function enableDisable_addHike(){function e(e){e?(t.disabled=!0,t.classList.add("disabled")):(t.disabled=!1,t.classList.remove("disabled"))}var t=document.getElementById("button_addUpdateHike");return e(!1),""!==document.getElementById("span_fileerror").innerHTML?(document.getElementsByClassName("jqdl-attachments")[0].classList.add("has-error"),void e(!0)):$(this).find(".has-error").length>0?void e(!0):""===document.getElementById("select_remainingpeaks").value&&""===document.getElementById("div_peaks_container").innerHTML&&""===document.getElementById("textbox_hikedate").innerHTML?void e(!0):void 0}function addPeak(e){if(e||(e=document.getElementById("select_remainingpeaks")),""!=e.value){var t=e.options[e.selectedIndex],n=e.value,a=t.innerHTML;e.selectedIndex=-1;var d=document.getElementById("div_peaks_container"),i=document.createElement("span");i.innerHTML=a,i.classList.add("redhover"),i.setAttribute("onclick","removePeak(this);"),i.setAttribute("data-peakid",n),i.setAttribute("title","Remove Peak"),i.setAttribute("data-toggle","tooltip"),i.setAttribute("data-container","body"),d.appendChild(i),t.disabled=!0,tooltip()}}function removePeak(e){for(var t=$(e).data("peakid"),n=document.getElementById("select_remainingpeaks"),a=0;a<n.children.length;a++)if(n.children[a].value==t){n.children[a].disabled=!1;break}var d=e.parentNode;d.removeChild(e),enable_disable_addPeak()}function enable_disable_addPeak(){document.getElementById("button_addUpdateHike").disabled=!1,""==$("#select_remainingpeaks").value&&""==$("#div_peaks_container")[0].innerHTML&&(document.getElementById("button_addUpdateHike").disabled=!0),""==$("#textbox_hikedate")[0].value&&(document.getElementById("button_addUpdateHike").disabled=!0)}function enableDisableSelectOptions(e){for(var t=document.getElementById("select_remainingpeaks"),n=0;n<t.children.length;n++)t.children[n].disabled=!1,-1!==e.indexOf(parseInt(t.children[n].value))&&(t.children[n].disabled=!0)}function removeFile(e,t){hidden_prefileids=document.getElementById("hidden_prefileids");for(var n=hidden_prefileids.value.split(","),a=[],d=0;d<n.length;d++)n[d]!==t&&a.push(n[d]);hidden_prefileids.value=a.join(","),e.parentNode.outerHTML=""}$(document).ready(function(){$("#span_addPeak").click(function(){enable_disable_addPeak()}),$("#textbox_hikedate, #select_remainingpeaks").keyup(function(){enable_disable_addPeak()});var e=document.getElementById("hidden_ADK_MESSAGE_JSON");if(e){var t=JSON.parse(e.value);document.getElementById("textbox_notes").value=t.ADK_MESSAGE_CONTENT;for(var n=[],a=0;a<t.ADK_FILES.length;a++){n.push(t.ADK_FILES[a].ADK_FILE_ID);var d='<li><a class="pointer hoverbtn" data-id="'+t.ADK_FILES[a].ADK_FILE_ID+'" data-desc="'+t.ADK_FILES[a].ADK_FILE_DESC+'" data-size="'+t.ADK_FILES[a].ADK_FILE_SIZE+'"onclick="getFile('+t.ADK_FILES[a].ADK_FILE_ID+');">'+t.ADK_FILES[a].ADK_FILE_NAME+"</a></li>";document.getElementById("ul_hikeattachments").innerHTML+=d}document.getElementById("hidden_prefileids").value=n.join(","),$("html, body").animate({scrollTop:$(span_maxminAddUpdateHike).offset().top},600)}$("#form_addUpdateHike").on("change",enableDisable_addHike)});
function addUpdateHike(e){function t(){return $("#ul_addpeaks li").get().map(function(e){return ADK_PEAK={ADK_PEAK_ID:$(e.children[0]).data("peakid"),ADK_PEAK_DTE:e.children[1].innerHTML},ADK_PEAK})}addPeak();var n=t();if(0==n.length)return!1;document.getElementById("hidden_peaks").value=n.map(function(e){return e.ADK_PEAK_ID+" "+e.ADK_PEAK_DTE}).join(",");var a="Add Hike"===document.getElementById("h4span_addUpdateHike").innerHTML?"includes/hikeSave.php":"includes/hikeUpdate.php";$.ajax({url:a,data:new FormData(e),processData:!1,contentType:!1,enctype:"multipart/form-data",type:"POST",timeout:12e4,success:function(e){$("#div_modal_loading").modal("hide"),document.getElementById("div_table_hikes").innerHTML=e;var t=document.getElementById("table_hikes");document.getElementById("span_numclimbed").innerHTML=t.getAttribute("data-numclimbed"),document.getElementById("span_numpeaks").innerHTML=t.getAttribute("data-numpeaks")+" ("+t.getAttribute("data-percent")+"%)",cancelHike();var n=document.getElementById("a_maxmin_hike_data");-1!==n.children[0].className.indexOf("down")&&$(n).click(),$(".dt").DataTable({pageLength:20,lengthChange:!1,order:[2,"desc"],columnDefs:[{targets:0,searchable:!1,sortable:!1}]}),markCompletedPeaks()},error:function(e){var t="";-1!==e.responseText.indexOf("t")&&(t+="Invalid file type\r\n"),-1!==e.responseText.indexOf("p")&&(t+=-1!==e.responseText.indexOf("1")||-1!==e.responseText.indexOf("2")?"Max file size exceeded\r\n":"Error uploading file\r\n"),alert(t),console.log(t),$("#div_modal_loading").modal("hide")}}),$("#div_modal_loading").modal("show")}function editHike(){cancelHike();var e=document.getElementById("span_maxminAddUpdateHike");e.classList.contains("glyphicon-chevron-up")&&$(e.parentNode).click();var t=document.getElementsByClassName("viewing")[0],n=getHikeInfo(t),a=(document.getElementById("ul_addpeaks"),document.getElementById("ul_hikeattachments"));document.getElementById("h4span_addUpdateHike").innerHTML="Update Hike",document.getElementById("button_addUpdateHike").innerHTML="Update Hike",document.getElementById("hidden_hikeid").value=n.ADK_HIKE_ID;for(var d=0;d<n.ADK_PEAKS.length;d++)addPeakLi(n.ADK_PEAKS[d]);for(var i=[],d=0;d<n.ADK_FILES.length;d++){var l=document.createElement("li");l.innerHTML='<a class="pointer hoverbtn redhover" onclick="removeFile(this, \''+n.ADK_FILES[d].ADK_FILE_ID+'\');" title="Size: '+$.fn.downloader.bytesToSize(n.ADK_FILES[d].ADK_FILE_SIZE)+"  Desc: "+n.ADK_FILES[d].ADK_FILE_DESC+'">'+n.ADK_FILES[d].ADK_FILE_NAME+"</a>",l.className="redhover",a.appendChild(l),i.push(n.ADK_FILES[d].ADK_FILE_ID)}document.getElementById("hidden_prefileids").value=i.join(","),document.getElementById("textbox_hikedate").value=n.ADK_HIKE_DTE;var o=getWysiIframeBody();o?o.innerHTML=n.ADK_HIKE_NOTES:document.getElementById("textbox_notes").value=n.ADK_HIKE_NOTES,$("html, body").animate({scrollTo:$(e).offset().top},600),enableDisable_addHike()}function deleteHike(){cancelHike();var e=document.getElementsByClassName("viewing")[0];$.post("includes/hikeDelete.php",{userid:document.getElementById("hikerId").value,hikeid:getHikeInfo(e).ADK_HIKE_ID},function(e){var t=document.getElementById("div_hike_data").parentNode;t.className=t.className.replace("max","min"),document.getElementById("div_table_hikes").innerHTML=e,document.getElementById("span_numpeaks").innerHTML=document.getElementById("table_hikes").getAttribute("data-numpeaks"),$(".dt").DataTable({pageLength:20,lengthChange:!1,order:[2,"desc"],columnDefs:[{targets:0,searchable:!1,sortable:!1}]}),markCompletedPeaks()}).error(function(e){var t="";-1!==e.responseText.indexOf("t")&&(t+="Invalid file type\r\n"),-1!==e.responseText.indexOf("p")&&(t+=-1!==e.responseText.indexOf("1")||-1!==e.responseText.indexOf("2")?"Max file size exceeded\r\n":"Error uploading file\r\n"),alert(t),console.log(t),$("#div_modal_loading").modal("hide")})}function cancelHike(){var e=document.getElementById("select_addpeaks");document.getElementById("h4span_addUpdateHike").innerHTML="Add Hike",document.getElementById("button_addUpdateHike").innerHTML="Add Hike",e.value="",document.getElementById("textbox_hikedate").value="",document.getElementById("textbox_notes").value="",document.getElementById("hidden_prefileids").value="";var t=getWysiIframeBody();t&&(t.innerHTML="");for(var n=document.getElementById("ul_addpeaks");n.firstChild;)n.removeChild(n.firstChild);for(document.getElementById("ul_hikeattachments").innerHTML="";ul_hikeattachments.firstChild;)ul_hikeattachments.removeChild(ul_hikeattachments.firstChild);$.fn.downloader.removeAll(),$(".wysihtml5-command-active").each(function(){$(this).click()}),markCompletedPeaks()}function getHikeInfo(e){var t=e.children[0].value,n=e.children[2].innerHTML,a="--"!==e.children[3].value?e.children[3].value:"",d=[].slice.call(e.children[4].children).map(function(e){return{ADK_PEAK_ID:$(e).data("id"),ADK_PEAK_NAME:$(e).data("name"),ADK_PEAK_HEIGHT:$(e).data("height"),ADK_PEAK_DTE:$(e).data("date")}}),i=[].slice.call(e.children[5].children).map(function(e){return{ADK_FILE_ID:$(e).data("id"),ADK_FILE_NAME:$(e).data("name"),ADK_FILE_DESC:$(e).data("desc"),ADK_FILE_SIZE:$(e).data("size"),ADK_FILE_TYPE:$(e).data("type")}});return{ADK_HIKE_ID:t,ADK_HIKE_NOTES:n,ADK_HIKE_DTE:a,ADK_PEAKS:d,ADK_FILES:i}}function viewHike(e){$(".viewing").each(function(){this.classList.remove("viewing")}),e.classList.add("viewing");var t=getHikeInfo(e),n=document.getElementById("table_hikespeaks"),a=document.getElementById("p_hikenotes");n.children[1].innerHTML="",a.innerHTML=t.ADK_HIKE_NOTES,document.getElementById("a_heightFormat").innerHTML="(ft)";for(var d=0;d<t.ADK_PEAKS.length;d++){var i=document.createElement("tr"),l=document.createElement("td");l.innerHTML=t.ADK_PEAKS[d].ADK_PEAK_NAME;var o=document.createElement("td");o.innerHTML=t.ADK_PEAKS[d].ADK_PEAK_DTE;var r=document.createElement("td");r.innerHTML=t.ADK_PEAKS[d].ADK_PEAK_HEIGHT,i.appendChild(l),i.appendChild(o),i.appendChild(r),n.children[1].appendChild(i)}var s=$("ul.gallery-photo");s.empty();for(var d=0;d<t.ADK_FILES.length;d++)"photo"===t.ADK_FILES[d].ADK_FILE_TYPE&&($li=$('<li class="gallery col-xs-6 col-sm-4 col-md-3 col-lg-2">'),$a=$('<a href="#" class="photo" data-toggle="modal" data-target="#modal_gallery" data-id="'+t.ADK_FILES[d].ADK_FILE_ID+'" data-desc="'+t.ADK_FILES[d].ADK_FILE_DESC+'">'),$img=$('<img src="img/loading.gif" data-original="includes/fileGetImage.php?_='+t.ADK_FILES[d].ADK_FILE_ID+'&t=t" class="img-responsive imghover lazy" alt="'+t.ADK_FILES[d].ADK_FILE_NAME+'" title="'+t.ADK_FILES[d].ADK_FILE_NAME+'" data-toggle="tooltip" data-container="body" data-placement="bottom" />'),$li.append($a.append($img)),s.append($li)),$("img.lazy").lazyload({container:$("#div_photos"),effect:"fadeIn",threshold:10});bindPhotoModal(),$(e).parents("div.container-fluid")[0].nextElementSibling.classList.contains("content-min")&&$("#a_maxmin_hike_data").click(),tooltip(),$(".selecttable").trigger("update"),$("html, body").animate({scrollTop:$("#div_hike_data").offset().top},600)}function convertFormat(e){var t=document.getElementById("table_hikespeaks").children[1];if(-1===e.innerHTML.indexOf("m")){for(var n=0;n<t.children.length;n++){var a=t.children[n].children[2];a.innerHTML=Math.round(parseFloat(a.innerHTML)/3.2808)}e.innerHTML="(m)"}else{for(var n=0;n<t.children.length;n++){var a=t.children[n].children[2];a.innerHTML=Math.round(3.2808*parseFloat(a.innerHTML))}e.innerHTML="(ft)"}}function enableDisable_addHike(){function e(e){e?(t.disabled=!0,t.classList.add("disabled")):(t.disabled=!1,t.classList.remove("disabled"))}var t=document.getElementById("button_addUpdateHike");if(e(!1),""!==document.getElementById("span_fileerror").innerHTML)return document.getElementsByClassName("jqdl-attachments")[0].classList.add("has-error"),void e(!0);if($(this).find(".has-error").length>0)return void e(!0);var n=document.getElementById("ul_addpeaks");return""===document.getElementById("select_addpeaks").value&&""===n.innerHTML?void e(!0):($(".addpeak-date").each(function(){return"???"===this.innerHTML?void e(!0):void 0}),""===n.innerHTML||""===document.getElementById("select_addpeaks").value&&""===document.getElementById("textbox_hikedate").value?void e(!1):void 0)}function modal_hike(){var e=getHikeInfo(document.querySelector("td.viewing"));document.getElementById("h4_modal_hike_label").innerHTML=e.ADK_PEAKS.map(function(e){return e.ADK_PEAK_NAME}).join(", "),document.getElementById("span_modal_hike_date").innerHTML=e.ADK_HIKE_DTE,document.getElementById("modal_dike_notes").innerHTML=e.ADK_HIKE_NOTES}function printView(){var e={ADK_USER_NAME:document.getElementById("hidden_ADK_HIKER_NAME").value,ADK_USER_USERNAME:document.getElementById("hidden_ADK_HIKER_USERNAME").value},t=getHikeInfo(document.querySelector("td.viewing")),n=window.open(),a="<script>function a(d){var b=document.body.style.fontSize? parseInt(document.body.style.fontSize.replace(/D/g,'')):100;if(b>=50&&b<=150){if(d)b+=10;else b-=10;}if(b<50)b=50;if(b>150)b=150;document.body.style.fontSize=b+'%';}</script>",d='<h3 style="margin-bottom:8px;text-align:center;">The Adirondack Forty-Sixers';d+='<div class="noprint" style="font-size:16px;float:right;"><a href="#" style="text-decoration:none;" onclick="a(0)" title="Zoom out">-</a>&nbsp;|&nbsp;<a href="#" style="text-decoration:none;" onclick="a(1)" title="Zoom in">+</a><br /></div>',d+="</h3>",d+='<img src="img/letterhead.png" style="height:70px;float:right;margin-right:10%;" onload="window.print()" />',d+="",d+="<span>"+e.ADK_USER_NAME+" ("+e.ADK_USER_USERNAME+")</span><br /><br />",d+="<span>Date: "+t.ADK_HIKE_DTE+"</span><br />",d+="<span>"+t.ADK_PEAKS.map(function(e){return e.ADK_PEAK_NAME}).join(", ")+"</span><br />",d+="----------------------------------------<br /><br />",d+='<pre style="word-break:break-word;">'+t.ADK_HIKE_NOTES+"</pre>",n.document.write(a+d)}function bindPhotoModal(){$("#div_photos .photo").on("click",function(){var e=getDownloadLink(this.getAttribute("data-id"))+"<strong>"+this.getAttribute("data-un")+"</strong><br />"+this.getAttribute("data-peaks")+'<div class="hr"></div>'+this.getAttribute("data-desc");document.getElementById("modal_gallery_label").innerHTML=this.children[0].getAttribute("alt"),document.getElementById("modal_gallery_desc").innerHTML=e;var t=this.children[0].cloneNode();return t.setAttribute("data-original",t.src.replace("&t=t","")),t.src="img/loading.gif",t.classList.remove("imghover"),$("#modal_gallery_container").html("").append(t),$(t).attr("src",$(t).data("original")),!0}),$("#div_photos .video").on("click",function(){var e=this.getAttribute("data-id"),t=this.children[0].innerHTML,n=getDownloadLink(this.getAttribute("data-id"))+"<strong>"+this.getAttribute("data-un")+"</strong><br />"+this.getAttribute("data-peaks")+'<div class="hr"></div>'+this.getAttribute("data-desc");document.getElementById("modal_gallery_label").innerHTML=t,document.getElementById("modal_gallery_desc").innerHTML=n;var a=document.createElement("video");return a.setAttribute("id","video"),a.setAttribute("controls","controls"),a.setAttribute("width","100%"),a.innerHTML='<source id="videosource" src="includes/fileGetVideo.php?_='+e+'" type="video/'+t.split(".").pop()+'" />',document.getElementById("modal_gallery_container").innerHTML=a.outerHTML,bindVideoError(),!0})}function addPeak(e){if(e||(e=document.getElementById("select_addpeaks")),""!==e.value){var t=e.options[e.selectedIndex];t.classList.add("font-italic");var n=document.getElementById("textbox_hikedate"),a={ADK_PEAK_ID:e.value,ADK_PEAK_NAME:t.innerHTML,ADK_PEAK_DTE:n.value};if(!/(0[1-9]|1[012])[- \/.](0[1-9]|[12][0-9]|3[01])[- \/.](19|20)\d\d/.test(a.ADK_PEAK_DTE))return $(n).blur(),!1;e.selectedIndex=-1,addPeakLi(a),tooltip()}}function addPeakLi(e){var t=document.getElementById("ul_addpeaks"),n=$("<li>"),a=$('<a class="addpeak-name" title="Remove Peak" data-toggle="tooltip" data-container="body" data-peakid="'+e.ADK_PEAK_ID+'">'+e.ADK_PEAK_NAME+"</a>"),d=$('<a class="addpeak-date">'+("--"===e.ADK_PEAK_DTE?"???":e.ADK_PEAK_DTE)+"</a>");n.append(a),n[0].innerHTML+="(",n.append(d),n[0].innerHTML+=")",t.appendChild(n[0])}function editPeakDate(e){var t=$('<input type="text" class="date" value="'+e.innerHTML+'" style="visibility:hidden;width:0;height:0;">');$(e.parentNode).append(t),t.datepicker({changeMonth:!0,changeYear:!0,maxDate:"+2d",yearRange:"-100:+0"}).datepicker("show").on("change",function(){$(this).datepicker("hide").datepicker("destroy"),e.innerHTML=this.value,enableDisable_addHike(),$(this).remove()}).on("blur",function(){enableDisable_addHike(),$(this).remove()})}function removePeak(e){$(e.parentNode).remove(),enableDisable_addHike(),tooltip(),markCompletedPeaks();var t=document.getElementById("select_addpeaks").children;$(".addpeak-name").each(function(){for(var e=0;e<t.length;e++)$(this).data("peakid")==t[e].value&&t[e].classList.add("font-italic")})}function markCompletedPeaks(){var e=document.getElementById("hidden_usedPeakIDs").value.split(",");$("#select_addpeaks option").each(function(){-1!==e.indexOf(this.value)?this.classList.add("font-italic"):this.classList.remove("font-italic")})}function removeFile(e,t){hidden_prefileids=document.getElementById("hidden_prefileids");for(var n=hidden_prefileids.value.split(","),a=[],d=0;d<n.length;d++)n[d]!==t&&a.push(n[d]);hidden_prefileids.value=a.join(","),e.parentNode.outerHTML=""}$(document).ready(function(){var e=document.getElementById("hidden_ADK_MESSAGE_JSON");if(e){var t=JSON.parse(e.value);document.getElementById("textbox_notes").value=t.content;for(var n=[],a=0;a<t.files.length;a++){n.push(t.files[a].id);var d='<li><a class="pointer hoverbtn" data-id="'+t.files[a].id+'" data-desc="'+t.files[a].desc+'" data-size="'+t.files[a].size+'"onclick="getFile('+t.files[a].id+');">'+t.files[a].name+"</a></li>";document.getElementById("ul_hikeattachments").innerHTML+=d}document.getElementById("hidden_prefileids").value=n.join(","),$("html, body").animate({scrollTop:$(span_maxminAddUpdateHike).offset().top},600)}if($("#form_addUpdateHike, #textbox_hikedate").on("change",enableDisable_addHike),parseInt(window.location.hash.replace("#",""))){var i=window.location.hash.replace("#","");$('input[name="hikeid"][value="'+i+'"]').parent().children().last().click()}$("#ul_addpeaks").on("click",".addpeak-name",function(){removePeak(this)}).on("mouseenter",".addpeak-name",function(){this.parentNode.classList.add("redhover-on")}).on("mouseleave",".addpeak-name",function(){this.parentNode.classList.remove("redhover-on")}),$("#ul_addpeaks").on("click",".addpeak-date",function(){editPeakDate(this)}),markCompletedPeaks()});
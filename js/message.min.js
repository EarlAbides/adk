function populateNewMessage(){var e=document.getElementById("hidden_usergroupcde").value;switch(e){case"ADM":var n=document.getElementById("hidden_touserid").value;document.getElementById("select_to_username").value=n;break;case"COR":var n=document.getElementById("hidden_touserid").value;document.getElementById("select_to_username").value=n;break;case"HIK":var t=document.getElementById("hidden_tousername").value,d=document.getElementById("hidden_touserusername").value;document.getElementById("textbox_to_username").value=t+" ("+d+")"}}function newMessage(){var e=document.getElementById("template_newMessage").innerHTML;if(document.getElementById("div_messages_main").innerHTML=e,$("#downloader").downloader({desc:!0}),"HIK"==document.getElementById("hidden_usergroupcde").value){var n=document.getElementById("hidden_coruserid").value,t=document.getElementById("hidden_corusername").value,d=document.getElementById("hidden_coruserusername").value,s=document.getElementById("hidden_coruseremail").value;document.getElementById("hidden_touserid").value=n,document.getElementById("hidden_touseremail").value=s,document.getElementById("textbox_to_username").value=t+" ("+d+")"}else{var a=document.getElementById("select_to_username");a.disabled=!1,document.getElementById("hidden_touserid").value=document.getElementById("select_to_username").children[0].value,$(a).change(function(){document.getElementById("hidden_touserid").value=this.value})}}function reply(){var e=document.getElementById("hidden_viewfromid").value,n=document.getElementById("span_messagefromusername").innerHTML,t=document.getElementById("hidden_viewfromid").value,d=document.getElementById("span_messagetousername").innerHTML,s=document.getElementById("span_messagesubject").innerHTML,a=document.getElementById("span_messagedte").innerHTML,i=document.getElementById("span_messagecontent").innerHTML;if(e==document.getElementById("hidden_userid").value){var r=t;t=e,e=r}var m="\r\n\r\n\r\n---------------------\r\n";m+="From: "+n+"\r\n",m+="To: "+d+"\r\n",m+="Date: "+a+"\r\n\r\n",m+=i;var o=document.getElementById("template_newMessage").innerHTML;if(document.getElementById("div_messages_main").innerHTML=o,$("#downloader").downloader({desc:!0}),"HIK"==document.getElementById("hidden_usergroupcde").value)document.getElementById("textbox_to_username").value=d;else{var l=document.getElementById("select_to_username");l.disabled=!0,l.value=t,$(l).change(function(){document.getElementById("hidden_touserid").value=this.value})}document.getElementById("legend_newMessageReply").innerHTML="Reply",document.getElementById("textbox_subject").value="RE: "+s,document.getElementById("textbox_message").value=m,document.getElementById("hidden_touserid").value=t}function cancelMessage(){document.getElementById("div_messages_main").innerHTML=""}function message_markRead(e,n){if("Inbox"==document.getElementById("h4_folderName").innerHTML){$.post("includes/ajax_messageMarkRead",{ADK_MESSAGE_ID:e},function(){n&&n.classList.remove("font-bold")});var t=document.getElementById("span_messages").children[0];t&&(t.innerHTML=parseInt(t.innerHTML)-1,0==t.innerHTML&&(t.outerHTML=""))}}function viewMessage(e){var n=document.getElementById("div_messages_main");$.post("includes/ajax_getMessage",{ADK_MESSAGE_ID:e},function(e){n.innerHTML="",n.innerHTML=document.getElementById("template_viewMessage").innerHTML;var t=JSON.parse(e);document.getElementById("span_messagefromusername").innerHTML=t.ADK_MESSAGE_FROM_NAME+" ("+t.ADK_MESSAGE_FROM_USERNAME+")",document.getElementById("span_messagetousername").innerHTML=t.ADK_MESSAGE_TO_NAME+" ("+t.ADK_MESSAGE_TO_USERNAME+")",document.getElementById("span_messagesubject").innerHTML=t.ADK_MESSAGE_TITLE,document.getElementById("span_messagedte").innerHTML=t.ADK_MESSAGE_DTE+"&nbsp;"+t.ADK_MESSAGE_TME,document.getElementById("span_messagecontent").innerHTML=t.ADK_MESSAGE_CONTENT,document.getElementById("hidden_viewmessageid").value=t.ADK_MESSAGE_ID,document.getElementById("hidden_viewfromid").value=t.ADK_MESSAGE_FROM_USER_ID,document.getElementById("hidden_viewtoid").value=t.ADK_MESSAGE_TO_USER_ID,document.getElementById("button_reply").style.display=1===t.ADK_MESSAGE_FROM_USER_ID?"none":"";var d=document.getElementById("ul_messageattachments");if(""!==t.ADK_FILES){for(var s="",a=t.ADK_FILES,i=0;i<a.length;i++)s+='<li><a class="pointer hoverbtn" data-id="'+a[i].ADK_FILE_ID+'" data-desc="'+a[i].ADK_FILE_DESC+'" data-size="'+a[i].ADK_FILE_SIZE+'" onclick="getFile('+a[i].ADK_FILE_ID+');">'+a[i].ADK_FILE_NAME+"</a></li>";d.innerHTML=s}else d.innerHTML='<li style="font-style:italic;">none</li>';var r=document.getElementById("a_loghike");r&&(t.isFromHiker?r.setAttribute("href","./hiker?_="+t.ADK_MESSAGE_FROM_USER_ID+"&m="+t.ADK_MESSAGE_ID):r.style.display="none")})}function sortMessages(e){function n(e,n){return e.n<n.n?-1:e.n>n.n?1:0}function t(e,n){function t(e){var n=[],t=e.split(" ")[0].split("/"),d=e.split(" ")[1].split(":");n.push(parseInt(t[2])),n.push(parseInt(t[0])),n.push(parseInt(t[1]));var s=parseInt(d[0]),a=parseInt(d[1].substring(0,2)),i=d[1].substring(2,1);return"p"==i&&(s+=12),n.push(s),n.push(a),n}var d=t(e.d),s=t(n.d),a=new Date(d[0],d[1],d[2],d[3],d[4]),i=new Date(s[0],s[1],s[2],s[3],s[4]);return i>a?-1:a>i?1:0}e.nextElementSibling?(e.classList.add("active"),e.nextElementSibling.classList.remove("active")):(e.classList.add("active"),e.previousElementSibling.classList.remove("active"));var d=document.querySelectorAll(".messageSort");if(d[0].classList.contains("active"))var s="n";else var s="d";if(d[2].classList.contains("active"))var a="u";else var a="d";for(var i=[],r=document.getElementById("table_messages").children[1],m=0;m<r.children.length;m++)i.push({i:m,n:r.children[m].getAttribute("data-name"),d:r.children[m].getAttribute("data-date")});if(i.sort("n"==s?n:t),"d"==a&&i.reverse(),"n"==s)var o="data-name";else var o="data-date";for(var l="",m=0;m<i.length;m++){if("n"==s)var u=i[m].n;else var u=i[m].d;for(var c=0;c<r.children.length;c++)if(u==r.children[c].getAttribute(o)){l+=r.children[c].outerHTML,r.children[c].outerHTML="",c--;break}}r.innerHTML=l,rebind_messagesClick()}function getFolder(e){$.post("includes/ajax_messageGetFolder",{ADK_USER_ID:document.getElementById("hidden_userid").value,id:e},function(n){document.getElementById("div_table_messages").innerHTML=n,rebind_messagesClick();var t=document.querySelectorAll(".messageSort");t[0].classList.remove("active"),t[1].classList.add("active"),t[2].classList.remove("active"),t[3].classList.add("active");var d=document.getElementById("button_sortFromTo");switch(e){case 0:d.innerHTML="From";break;case 1:d.innerHTML="To"}})}function rebind_messagesClick(){$("a.messagebtn").click(function(){message_markRead(this.getAttribute("data-id"),this.children[1].children[0].children[0].children[0]),viewMessage(this.getAttribute("data-id"))})}function loadModal_viewMessage(){document.getElementById("h4_modal_viewMessage").innerHTML=document.getElementById("span_messagesubject").innerHTML,document.getElementById("span_modal_viewMessage_dte").innerHTML=document.getElementById("span_messagedte").innerHTML,document.getElementById("span_modal_viewMessage_message").innerHTML=document.getElementById("span_messagecontent").innerHTML}function deleteMessage(){if(!confirm("Are you sure you want to delete this message?"))return!1;var e=document.getElementById("h4_folderName");$.post("includes/ajax_messageDelete.php",{id:document.getElementById("hidden_viewmessageid").value,tofrom:"Sent"===e.innerHTML?"s":"i"},function(){getFolder("Sent"===document.getElementById("h4_folderName").innerHTML?1:0),newMessage()})}function printView(){var e=document.getElementById("span_messagefromusername").innerHTML,n=document.getElementById("span_messagetousername").innerHTML,t=document.getElementById("span_messagesubject").innerHTML,d=document.getElementById("span_messagedte").innerHTML,s=document.getElementById("span_messagecontent").innerHTML,a=window.open(),i="<script>function a(d){var b=document.body.style.fontSize? parseInt(document.body.style.fontSize.replace(/D/g,'')):100;if(b>=50&&b<=150){if(d)b+=10;else b-=10;}if(b<50)b=50;if(b>150)b=150;document.body.style.fontSize=b+'%';}</script>",r='<h3 style="margin-bottom:8px;text-align:center;">The Adirondack Forty-Sixers';r+='<div style="font-size:16px;float:right;"><a href="#" style="text-decoration:none;" onclick="a(0)" title="Zoom out">-</a>&nbsp;|&nbsp;<a href="#" style="text-decoration:none;" onclick="a(1)" title="Zoom in">+</a><br /></div>',r+="</h3>",r+='<img src="img/letterhead.png" style="height:70px;float:right;margin-right:10%;" onload="window.print()" />',r+="",r+="<span>From: "+e+"</span><br />",r+="<span>To: "+n+"</span><br />",r+="<span>Subject: "+t+"</span><br />",r+="<span>Date: "+d+"</span><br />",r+="----------------------------------------<br /><br />",r+='<pre style="word-break:break-word;">'+s+"</pre>",a.document.write(i+r)}$(document).ready(function(){if(document.getElementById("hidden_newMessage")){var e=document.getElementById("template_newMessage").innerHTML;document.getElementById("div_messages_main").innerHTML=e,$("#downloader").downloader({desc:!0}),populateNewMessage()}rebind_messagesClick(),$(".messageSort").click(function(){sortMessages(this)}),$("#select_to_username").change(function(){document.getElementById("hidden_touserid").value=this.value})});
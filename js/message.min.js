function populateNewMessage(){var e=document.getElementById("hidden_usergroupcde").value;switch(e){case"ADM":var t=document.getElementById("hidden_touserid").value;document.getElementById("select_to_username").value=t;break;case"COR":var t=document.getElementById("hidden_touserid").value;document.getElementById("select_to_username").value=t;break;case"HIK":var n=document.getElementById("hidden_tousername").value,d=document.getElementById("hidden_touserusername").value;document.getElementById("textbox_to_username").value=n+" ("+d+")"}}function newMessage(){var e=document.getElementById("template_newMessage").innerHTML;if(document.getElementById("div_messages_main").innerHTML=e,$("#downloader").downloader({desc:!0}),"HIK"===document.getElementById("hidden_usergroupcde").value){var t=document.getElementById("hidden_coruserid").value,n=document.getElementById("hidden_corusername").value,d=document.getElementById("hidden_coruserusername").value,s=document.getElementById("hidden_coruseremail").value;document.getElementById("hidden_touserid").value=t,document.getElementById("hidden_touseremail").value=s,document.getElementById("textbox_to_username").value=n+" ("+d+")"}else{var a=document.getElementById("select_to_username");a.disabled=!1,document.getElementById("hidden_touserid").value=document.getElementById("select_to_username").children[0].value,$(a).change(function(){document.getElementById("hidden_touserid").value=this.value})}initEditor()}function reply(){var e=document.getElementById("hidden_viewfromid").value,t=document.getElementById("span_messagefromusername").innerHTML,n=document.getElementById("hidden_viewfromid").value,d=document.getElementById("span_messagetousername").innerHTML,s=document.getElementById("span_messagesubject").innerHTML,a=document.getElementById("span_messagedte").innerHTML,i=document.getElementById("span_messagecontent").innerHTML;if(e==document.getElementById("hidden_userid").value){var o=n;n=e,e=o}var r="<br /><br /><br />---------------------<br />";r+="From: "+t+"<br />",r+="To: "+d+"<br />",r+="Date: "+a+"<br /><br />",r+=i;var m=document.getElementById("template_newMessage").innerHTML;if(document.getElementById("div_messages_main").innerHTML=m,$("#downloader").downloader({desc:!0}),"HIK"==document.getElementById("hidden_usergroupcde").value)document.getElementById("textbox_to_username").value=d;else{var l=document.getElementById("select_to_username");l.disabled=!0,l.value=n,$(l).change(function(){document.getElementById("hidden_touserid").value=this.value})}document.getElementById("legend_newMessageReply").innerHTML="Reply",document.getElementById("textbox_subject").value="RE: "+s,document.getElementById("textbox_message").value=r,document.getElementById("hidden_touserid").value=n,initEditor()}function cancelMessage(){document.getElementById("div_messages_main").innerHTML="",editor.destroy()}function message_markRead(e,t){if("Inbox"==document.getElementById("h4_folderName").innerHTML){$.post("includes/ajax_messageMarkRead",{ADK_MESSAGE_ID:e},function(){t&&t.classList.remove("font-bold")});var n=document.getElementById("span_messages").children[0];n&&(n.innerHTML=parseInt(n.innerHTML)-1,0==n.innerHTML&&(n.outerHTML=""))}}function viewMessage(e){var t=document.getElementById("div_messages_main");$.post("includes/ajax_getMessage",{ADK_MESSAGE_ID:e},function(e){t.innerHTML="",t.innerHTML=document.getElementById("template_viewMessage").innerHTML;var n=JSON.parse(e);document.getElementById("span_messagefromusername").innerHTML=n.ADK_MESSAGE_FROM_NAME+" ("+n.ADK_MESSAGE_FROM_USERNAME+")",document.getElementById("span_messagetousername").innerHTML=n.ADK_MESSAGE_TO_NAME+" ("+n.ADK_MESSAGE_TO_USERNAME+")",document.getElementById("span_messagesubject").innerHTML=n.ADK_MESSAGE_TITLE,document.getElementById("span_messagedte").innerHTML=n.ADK_MESSAGE_DTE+"&nbsp;"+n.ADK_MESSAGE_TME,document.getElementById("span_messagecontent").innerHTML=n.ADK_MESSAGE_CONTENT,document.getElementById("hidden_viewmessageid").value=n.ADK_MESSAGE_ID,document.getElementById("hidden_viewfromid").value=n.ADK_MESSAGE_FROM_USER_ID,document.getElementById("hidden_viewtoid").value=n.ADK_MESSAGE_TO_USER_ID,1===n.ADK_MESSAGE_FROM_USER_ID?document.getElementById("button_reply").style.display="none":document.getElementById("button_reply").style.display="";var d=document.getElementById("ul_messageattachments");if(""!==n.ADK_FILES){for(var s="",a=n.ADK_FILES,i=0;i<a.length;i++)s+='<li><a class="pointer hoverbtn" data-id="'+a[i].ADK_FILE_ID+'" data-desc="'+a[i].ADK_FILE_DESC+'" data-size="'+a[i].ADK_FILE_SIZE+'" onclick="getFile('+a[i].ADK_FILE_ID+');">'+a[i].ADK_FILE_NAME+"</a></li>";d.innerHTML=s}else d.innerHTML='<li style="font-style:italic;">none</li>';var o=document.getElementById("a_loghike");o&&(n.isFromHiker?o.setAttribute("href","./hiker?_="+n.ADK_MESSAGE_FROM_USER_ID+"&m="+n.ADK_MESSAGE_ID):o.style.display="none")})}function sortMessages(e){function t(e,t){return e.n<t.n?-1:e.n>t.n?1:0}function n(e,t){function n(e){var t=[],n=e.split(" ")[0].split("/"),d=e.split(" ")[1].split(":");t.push(parseInt(n[2])),t.push(parseInt(n[0])),t.push(parseInt(n[1]));var s=parseInt(d[0]),a=parseInt(d[1].substring(0,2)),i=d[1].substring(2,1);return"p"==i&&(s+=12),t.push(s),t.push(a),t}var d=n(e.d),s=n(t.d),a=new Date(d[0],d[1],d[2],d[3],d[4]),i=new Date(s[0],s[1],s[2],s[3],s[4]);return i>a?-1:a>i?1:0}e.nextElementSibling?(e.classList.add("active"),e.nextElementSibling.classList.remove("active")):(e.classList.add("active"),e.previousElementSibling.classList.remove("active"));var d=document.querySelectorAll(".messageSort");if(d[0].classList.contains("active"))var s="n";else var s="d";if(d[2].classList.contains("active"))var a="u";else var a="d";for(var i=[],o=document.getElementById("table_messages").children[1],r=0;r<o.children.length;r++)i.push({i:r,n:o.children[r].getAttribute("data-name"),d:o.children[r].getAttribute("data-date")});if("n"==s?i.sort(t):i.sort(n),"d"==a&&i.reverse(),"n"==s)var m="data-name";else var m="data-date";for(var l="",r=0;r<i.length;r++){if("n"==s)var u=i[r].n;else var u=i[r].d;for(var c=0;c<o.children.length;c++)if(u==o.children[c].getAttribute(m)){l+=o.children[c].outerHTML,o.children[c].outerHTML="",c--;break}}o.innerHTML=l,bind_messagesClick()}function getFolder(e){$.post("includes/ajax_messageGetFolder",{ADK_USER_ID:document.getElementById("hidden_userid").value,id:e},function(t){document.getElementById("div_table_messages").innerHTML=t,bind_messagesClick();var n=document.querySelectorAll(".messageSort");switch(n[0].classList.remove("active"),n[1].classList.add("active"),n[2].classList.remove("active"),n[3].classList.add("active"),e){case 0:document.getElementById("button_sortFromTo").innerHTML="From";break;case 1:case 2:document.getElementById("button_sortFromTo").innerHTML="To"}$(".folder").removeClass("active").eq(e).addClass("active")})}function bind_messagesClick(){$("a.messagebtn").click(function(){"Drafts"===document.getElementById("h4_folderName").innerHTML?openDraft(this.getAttribute("data-id")):(message_markRead(this.getAttribute("data-id"),this.children[1].children[0].children[0].children[0]),viewMessage(this.getAttribute("data-id")))})}function openDraft(e){newMessage(),$.post("includes/ajax_getMessage",{ADK_MESSAGE_ID:e},function(t){var n=JSON.parse(t);"HIK"!==document.getElementById("hidden_usergroupcde").value&&(document.getElementById("select_to_username").value=n.ADK_MESSAGE_TO_USER_ID),document.getElementById("textbox_subject").value=n.ADK_MESSAGE_TITLE;var d=getWysiIframeBody();d?d.innerHTML=n.ADK_MESSAGE_CONTENT:document.getElementById("textbox_message").value=n.ADK_MESSAGE_CONTENT;var s=document.getElementById("ul_messageattachments");if(""!==n.ADK_FILES){for(var a="",i=n.ADK_FILES,o=0;o<i.length;o++)a+='<li><a class="pointer hoverbtn" data-id="'+i[o].ADK_FILE_ID+'" data-desc="'+i[o].ADK_FILE_DESC+'" data-size="'+i[o].ADK_FILE_SIZE+'" onclick="getFile('+i[o].ADK_FILE_ID+');">'+i[o].ADK_FILE_NAME+"</a></li>";s.innerHTML=a}var r=document.createElement("input"),m=document.getElementById("form_newMessage"),l=document.createElement("input");r.setAttribute("type","hidden"),r.setAttribute("name","wasdraft"),r.value="true",l.setAttribute("type","hidden"),l.setAttribute("name","messageid"),l.value=e,m.appendChild(r),m.appendChild(l)})}function loadModal_viewMessage(){document.getElementById("h4_modal_viewMessage").innerHTML=document.getElementById("span_messagesubject").innerHTML,document.getElementById("span_modal_viewMessage_dte").innerHTML=document.getElementById("span_messagedte").innerHTML,document.getElementById("span_modal_viewMessage_message").innerHTML=document.getElementById("span_messagecontent").innerHTML}function deleteMessage(){if(!confirm("Are you sure you want to delete this message?"))return!1;var e=document.getElementById("h4_folderName");$.post("includes/ajax_messageDelete.php",{id:document.getElementById("hidden_viewmessageid").value,tofrom:"Sent"===e.innerHTML?"s":"i"},function(){getFolder("Sent"===document.getElementById("h4_folderName").innerHTML?1:0),newMessage()})}function printView(){var e=document.getElementById("span_messagefromusername").innerHTML,t=document.getElementById("span_messagetousername").innerHTML,n=document.getElementById("span_messagesubject").innerHTML,d=document.getElementById("span_messagedte").innerHTML,s=document.getElementById("span_messagecontent").innerHTML,a=window.open(),i="<script>function a(d){var b=document.body.style.fontSize? parseInt(document.body.style.fontSize.replace(/D/g,'')):100;if(b>=50&&b<=150){if(d)b+=10;else b-=10;}if(b<50)b=50;if(b>150)b=150;document.body.style.fontSize=b+'%';}</script>",o='<h3 style="margin-bottom:8px;text-align:center;">The Adirondack Forty-Sixers';o+='<div class="noprint" style="font-size:16px;float:right;"><a href="#" style="text-decoration:none;" onclick="a(0)" title="Zoom out">-</a>&nbsp;|&nbsp;<a href="#" style="text-decoration:none;" onclick="a(1)" title="Zoom in">+</a><br /></div>',o+="</h3>",o+='<img src="img/letterhead.png" style="height:70px;float:right;margin-right:10%;" onload="window.print()" />',o+="",o+="<span>From: "+e+"</span><br />",o+="<span>To: "+t+"</span><br />",o+="<span>Subject: "+n+"</span><br />",o+="<span>Date: "+d+"</span><br />",o+="----------------------------------------<br /><br />",o+='<pre style="word-break:break-word;">'+s+"</pre>",a.document.write(i+o)}function saveDraft(){var e=document.createElement("input"),t=document.getElementById("form_newMessage");e.setAttribute("type","hidden"),e.setAttribute("name","draft"),e.value="true",t.appendChild(e),t.submit()}function saveTemplate(){""!==editor.composer.element.innerHTML&&"Message"!==editor.composer.element.innerHTML&&""!==document.getElementById("textbox_subject").value&&$.fn.downloader.getFileIndex().indexOf("0")>-1&&$.post("includes/templateSave.php",{ADK_MSG_TMPL_NAME:document.getElementById("textbox_subject").value,ADK_MSG_TMPL_CONTENT:editor.composer.element.innerHTML}).done(function(){document.getElementById("textbox_subject").value="",$(editor.composer.element).empty()}).fail(function(){alert("Error saving template")})}function initEditor(){editor=new wysihtml5.Editor("textbox_message",{toolbar:"wysihtml-toolbar",parserRules:wysihtml5ParserRules,stylesheets:"css/wysihtml.css"})}$(document).ready(function(){if(document.getElementById("hidden_newMessage")){var e=document.getElementById("template_newMessage").innerHTML;document.getElementById("div_messages_main").innerHTML=e,$("#downloader").downloader({desc:!0}),populateNewMessage()}bind_messagesClick(),$(".messageSort").click(function(){sortMessages(this)}),$("#select_to_username").change(function(){document.getElementById("hidden_touserid").value=this.value})});var editor;